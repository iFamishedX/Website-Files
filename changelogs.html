<!-- Markdown container -->
<div id="card-container" class="markdown-body"></div>

<style>
body {
  font-family: 'Work Sans', sans-serif;
  padding: 0;
  margin: 0;
  background: #ffffff;
  color: #000;
  transition: background-color 0.5s ease, color 0.5s ease;
}
body.darkmode {
  background: #121212;
  color: #f0f0f0;
}

.markdown-body {
  background-color: transparent;
  padding: 20px;
  transition: background-color 0.5s ease;
}
body.darkmode .markdown-body {
  background-color: transparent;
}

#card-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
  gap: 20px;
}

.card {
  background-color: #ffffff;
  border: 1px solid #ddd;
  border-radius: 12px;
  padding: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  display: flex;
  flex-direction: column;
  transition: background-color 0.5s ease, border-color 0.5s ease;
}
body.darkmode .card {
  background-color: rgba(30, 30, 30, 0.85);
  border-color: #333;
}

.card h1, .card h2, .card h3 {
  font-weight: 600;
  margin: 0 0 8px;
}
.card h1 { font-size: 20px; }
.card h2 { font-size: 18px; }
.card h3 { font-size: 16px; }

.card p {
  font-size: 14px;
  color: #333;
  margin: 0 0 8px;
  transition: color 0.5s ease;
}
body.darkmode .card p {
  color: #ddd;
}

.card a {
  display: inline-block;
  margin-top: 10px;
  background-color: #962F30;
  color: #fff;
  padding: 8px 14px;
  border-radius: 6px;
  text-decoration: none;
  font-weight: 600;
  font-size: 14px;
  transition: background-color 0.5s ease, color 0.5s ease;
}
body.darkmode .card a {
  background-color: #b84a4c;
}

.changelog {
  display: none;
  margin-top: 10px;
  font-size: 14px;
  background: #f9f9f9;
  color: #000;
  padding: 10px;
  border-radius: 12px;
  border: 1px solid #ddd;
  transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease;
}
body.darkmode .changelog {
  background: #1e1e1e;
  color: #f0f0f0;
  border-color: #333;
}

.changelog h1, .changelog h2, .changelog h3 {
  font-weight: 600;
  margin-top: 1em;
  margin-bottom: 0.5em;
  font-size: 1.2em;
}

.changelog p {
  margin: 0.5em 0;
}

.changelog ul {
  list-style: none;
  padding-left: 12px;
  margin: 0.5em 0;
}
.changelog ul li {
  position: relative;
  padding-left: 14px;
  margin-bottom: 4px;
}
.changelog ul li::before {
  position: absolute;
  left: 0;
  color: #555;
  content: "•";
  transition: color 0.5s ease;
}
body.darkmode .changelog ul li::before {
  color: #aaa;
}

.changelog ul ul li::before { content: "◦"; }
.changelog ul ul ul li::before { content: "▸"; }
.changelog ul ul ul ul li::before { content: "•"; }
.changelog ul ul ul ul ul li::before { content: "◦"; }
.changelog ul ul ul ul ul ul li::before { content: "▸"; }

.changelog ol {
  padding-left: 16px;
  margin: 0.5em 0;
}

.changelog pre {
  background: #f6f8fa;
  color: #24292f;
  padding: 10px;
  border-radius: 8px;
  overflow-x: auto;
  margin: 0;
  transition: background-color 0.5s ease, color 0.5s ease;
}
body.darkmode .changelog pre {
  background: #2a2a2a;
  color: #f0f0f0;
}

.changelog code {
  font-family: monospace;
  font-size: 13px;
}

.changelog details {
  margin: 1em 0;
  padding: 0.5em;
  border: 1px solid #ccc;
  border-radius: 8px;
  background: #f0f0f0;
  transition: background-color 0.5s ease, border-color 0.5s ease;
}
body.darkmode .changelog details {
  background: #2a2a2a;
  border-color: #555;
}

.changelog summary {
  cursor: pointer;
  font-weight: 600;
}
</style>

<script>
marked.setOptions({ gfm: true, breaks: true });

const repo = "iFamishedX/Website-Markdown-Files";
const branch = "main";
const container = document.getElementById("card-container");

async function fetchMarkdownFiles(path = "") {
  const apiUrl = `https://api.github.com/repos/${repo}/contents/${path}?ref=${branch}`;
  const res = await fetch(apiUrl);
  const items = await res.json();

  const markdownFiles = [];

  for (const item of items) {
    if (item.type === "file" && item.name.endsWith(".md") && item.name.toLowerCase() !== "readme.md") {
      markdownFiles.push(item.path);
    } else if (item.type === "dir") {
      const nestedFiles = await fetchMarkdownFiles(item.path);
      markdownFiles.push(...nestedFiles);
    }
  }

  return markdownFiles;
}

function renderCard(filePath) {
  const timestamp = Date.now();
  const rawUrl = `https://raw.githubusercontent.com/${repo}/${branch}/${filePath}?t=${timestamp}`;

  fetch(rawUrl)
    .then(res => res.ok ? res.text() : Promise.reject("Not found"))
    .then(text => {
      const lines = text.split("\n");
      const title = lines[0] || filePath.split("/").pop();
      const description = lines[1] || "No description";
      const bodyLines = lines.slice(2).join("\n");
      const bodyHTML = bodyLines ? marked.parse(bodyLines) : "<p>No body content</p>";

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        ${marked.parse(title)}
        ${marked.parse(description)}
        <a href="#" onclick="toggleChangelog(this); return false;">Show full</a>
        <div class="changelog">${bodyHTML}</div>
      `;
      container.appendChild(card);
    })
    .catch(err => {
      const errorCard = document.createElement("div");
      errorCard.className = "card";
      errorCard.innerHTML = `<h3>${filePath}</h3><p>Error loading file: ${err}</p>`;
      container.appendChild(errorCard);
    });
}

fetchMarkdownFiles()
  .then(files => {
    if (files.length === 0) {
      container.innerHTML = `<div class="card"><h3>No markdown files found</h3></div>`;
      return;
    }
    files.forEach(renderCard);
  })
  .catch(err => {
    container.innerHTML = `<div class="card"><h3>Error fetching file list</h3><p>${err}</p></div>`;
  });

function toggleChangelog(link) {
  const log = link.nextElementSibling;
  if (log.style.display === "none" || !log.style.display) {
    log.style.display = "block";
    link.textContent = "Hide full";
  } else {
    log.style.display = "none";
    link.textContent = "Show full";
  }
}
</script>
